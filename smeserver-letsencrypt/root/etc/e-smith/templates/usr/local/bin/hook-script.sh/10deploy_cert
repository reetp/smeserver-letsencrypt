{
    use strict;
    use warnings;
    use esmith::ConfigDB;

    my $configDB = esmith::ConfigDB->open_ro or die("can't open Config DB");

    my $letsencryptStatus = $configDB->get_prop( 'letsencrypt', 'status' ) || 'disabled';

    if ( $letsencryptStatus ne 'disabled' ) {

    $OUT .= <<'_EOF';
    
    if [ $1 = "deploy_cert" ]; then
      KEY=$3
      CERT=$4
      CHAIN=$6
      echo "Set up modSSL db keys"
      /sbin/e-smith/db configuration setprop modSSL key $KEY
      /sbin/e-smith/db configuration setprop modSSL crt $CERT
      /sbin/e-smith/db configuration setprop modSSL CertificateChainFile $CHAIN
      echo "Signal events"
      /sbin/e-smith/signal-event ssl-update
      echo "All complete"
    fi
_EOF
    }
}
